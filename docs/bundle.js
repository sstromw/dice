(()=>{"use strict";class t{constructor(t=void 0){this.map=new Map(t),this.min_value=Number.MAX_SAFE_INTEGER,this.max_value=Number.MIN_SAFE_INTEGER}get(t){return this.map.get(t)||0}set(t,e){t<this.min_value&&(this.min_value=t),t>this.max_value&&(this.max_value=t),this.map.set(t,e)}increment(t,e){this.map.set(t,e+this.get(t))}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}}class e{constructor(t=void 0,e=void 0,r=!1,s=0){this._pmf=t,this._cdf=e,this.prefer_cdf=r,this.min_value=s,null==this._cdf&&(this.build_cdf(),this.prefer_cdf=!1),null==this._pmf&&(this.build_pmf(),this.prefer_cdf=!0)}[Symbol.iterator](){let t=this.min_value;for(;0==this.cdf(t);)t++;return{next:()=>({done:this.cdf(t-1)>.999999,value:[t++,this.pmf(t-1)]})}}build_cdf(){if(null==this._pmf)throw new Error("constructing empty sample space");if("function"==typeof this._pmf)this._cdf=t=>Array.from(Array(t+1).keys()).reduce(((t,e)=>t+this.pmf(e)),0);else{this._cdf=new t;let e=Array.from(this._pmf.keys()).sort(((t,e)=>t-e));this.min_value=e[0];let r=0;for(let t=0;t<e.length;t++)r+=this.pmf(e[t]),this._cdf.set(e[t],r)}}build_pmf(){if(null==this._cdf)throw new Error("constructing empty sample space");if("function"!=typeof this._cdf)throw this._pmf=new t,new Error("not implemented");this._pmf=t=>this.cdf(t)-this.cdf(t-1)}pmf(t){var e;return"function"==typeof this._pmf?this._pmf(t):(null===(e=this._pmf)||void 0===e?void 0:e.get(t))||0}cdf(t){var e,r,s;return"function"==typeof this._cdf?this._cdf(t):t<((null===(e=this._cdf)||void 0===e?void 0:e.min_value)||Number.MIN_SAFE_INTEGER)?0:t>((null===(r=this._cdf)||void 0===r?void 0:r.max_value)||Number.MAX_SAFE_INTEGER)?1:(null===(s=this._cdf)||void 0===s?void 0:s.get(t))||0}}class r{sample_space(){return void 0!==this._sample_space||(this._sample_space=new e(this.density())),this._sample_space}pmf(t){return this.sample_space().pmf(t)}cdf(t){return this.sample_space().cdf(t)}mean(){let t=0;for(let[e,r]of this.sample_space())t+=r*e;return t}variance(){let t=this.mean(),e=0;for(let[r,s]of this.sample_space())e+=s*Math.pow(r-t,2);return e}median(){return this.inverse_cdf(.5)}inverse_cdf(t){if(t<0||t>1)throw new Error(`invalid call to inverse_cdf: ${t}`);for(let[e,r]of this.sample_space())if(this.cdf(e)>=t)return e;throw new Error("this shouldn't be possible")}}class s extends r{constructor(t){super(),this.n=t,this.n=t}toString(){return`d${this.n}`}roll(){return 1+Math.floor(Math.random()*this.n)}eq(t){return t.n==this.n}density(){let e=new t;for(let t=1;t<=this.n;t++)e.set(t,1/this.n);return e}mean(){return(this.n+1)/2}variance(){return(Math.pow(this.n,2)-1)/12}median(){return Math.round((this.n+this.n%2)/2)}}class i extends r{constructor(t){super(),this.val=t,this.val=t}toString(){return this.val.toString()}roll(){return this.val}eq(t){return t.val==this.val}density(){return new t([[this.val,1]])}mean(){return this.val}variance(){return 0}median(){return this.val}inverse_cdf(t){return this.val}}class n extends r{constructor(t=.5){if(super(),this.p=t,t<0||t>1)throw new Error("probability out of bounds: "+t);this.p=t}toString(){return`C(${this.p})`}roll(){return Math.random()<this.p?1:0}eq(t){return this.p==t.p}density(){return new t([[0,1-this.p],[1,this.p]])}mean(){return this.p}variance(){return this.p*(1-this.p)}median(){return this.p<=.5?0:1}inverse_cdf(t){return t>=this.p?1:0}}class l extends r{constructor(t){if(super(),this.p=t,t<0||t>1)throw new Error("probability out of bounds: "+t);this.p=t}roll(){let t;for(t=1;Math.random()>this.p;t++);return t}eq(t){return t.p==this.p}density(){return new t}sample_space(){return void 0!==this._sample_space||(this._sample_space=new e((t=>t>0?Math.pow(1-this.p,t-1)*this.p:0),(t=>t>0?1-Math.pow(1-this.p,t):0))),this._sample_space}mean(){return 1/this.p}variance(){return(1-this.p)/Math.pow(this.p,2)}median(){return Math.ceil(-1/Math.log2(1-this.p))}inverse_cdf(t){return Math.log(1-t)/Math.log(1-this.p)}toString(){return`G(${this.p})`}}class o extends r{constructor(t){super(),this.rolls=t,this.rolls=t,this.length=this.rolls.length}toString(){return`(${this.rolls.map((t=>t.toString())).join("|")})`}roll(){let t=Math.floor(Math.random()*this.length);return this.rolls[t].roll()}eq(t){throw new Error("not implemented")}density(){let e=new t;for(let t of this.rolls)for(let[r,s]of t.sample_space())e.increment(r,s/this.length);return e}mean(){return this.rolls.reduce(((t,e)=>t+e.roll()),0)/this.length}}class h extends r{constructor(t,e,r,s){super(),this.op=t,this.left=e,this.right=r,this.symbol=s,this.op=t,this.left=e,this.right=r,this.symbol=s}toString(){return`${this.left} ${this.symbol} ${this.right}`}roll(){return this.op(this.left.roll(),this.right.roll())?1:0}}class a extends h{constructor(t,e){super(((t,e)=>t==e),t,e,"="),this.left=t,this.right=e}eq(t){return this.left.eq(t.left)&&this.right.eq(t.right)||this.right.eq(t.left)&&this.left.eq(t.right)}density(){let e=new t;for(let[t,r]of this.left.sample_space())e.increment(1,r*this.right.pmf(t));return e.set(0,1-e.get(1)),e}}class u extends h{constructor(t,e){super(((t,e)=>t!=e),t,e,"!="),this.left=t,this.right=e}eq(t){return this.left.eq(t.left)&&this.right.eq(t.right)||this.right.eq(t.left)&&this.left.eq(t.right)}density(){let e=new t;for(let[t,r]of this.left.sample_space())e.increment(0,r*this.right.pmf(t));return e.set(1,1-e.get(0)),e}}class p extends h{constructor(t,e){super(((t,e)=>t>e),t,e,">"),this.left=t,this.right=e}eq(t){return this.left.eq(t.left)&&this.right.eq(t.right)}density(){let e=new t;for(let[t,r]of this.left.sample_space())e.increment(1,r*this.right.cdf(t-1));return e.set(0,1-e.get(1)),e}}class d extends h{constructor(t,e){super(((t,e)=>t<=e),t,e,"<="),this.left=t,this.right=e}eq(t){return this.left.eq(t.left)&&this.right.eq(t.right)}density(){let e=new t;for(let[t,r]of this.left.sample_space())e.increment(0,r*this.right.cdf(t-1));return e.set(1,1-e.get(0)),e}}class c extends h{constructor(t,e){super(((t,e)=>t<e),t,e,"<"),this.left=t,this.right=e}eq(t){return this.left.eq(t.left)&&this.right.eq(t.right)}density(){let e=new t;for(let[t,r]of this.left.sample_space())e.increment(1,r*(1-this.right.cdf(t)));return e.set(0,1-e.get(1)),e}}class f extends h{constructor(t,e){super(((t,e)=>t>=e),t,e,">="),this.left=t,this.right=e}eq(t){return this.left.eq(t.left)&&this.right.eq(t.right)}density(){let e=new t;for(let[t,r]of this.left.sample_space())e.increment(0,r*(1-this.right.cdf(t)));return e.set(1,1-e.get(0)),e}}function m(t,e){if(t.rolls.length!=e.rolls.length)return!1;let r=Array.from(Array(t.rolls.length),(t=>!0));for(let s of t.rolls){let i=0,n=!1;for(;i<t.rolls.length;)r[i]&&s.eq(e.rolls[i])&&(r[i]=!1,i=t.rolls.length,n=!0),i++;if(!n)return!1}return!0}class v extends r{constructor(t,e,r){super(),this.rolls=t,this.op=e,this.symbol=r,this.rolls=t,this.op=e,this.symbol=r}roll(){return this.op(this.rolls.map((t=>t.roll())))}eq(t){return this.symbol===t.symbol&&m(this,t)}density(){let r=this.rolls[0].sample_space();for(let s=1;s<this.rolls.length;s++){let i=new t;for(let[t,e]of r)for(let[r,n]of this.rolls[s].sample_space()){let s=this.op([t,r]);i.increment(s,e*n)}r=new e(i)}return r._pmf}toString(){let t=this.rolls.map((t=>t.toString())).join(",");return`${this.symbol}(${t})`}}let g=t=>t.reduce(((t,e)=>t+e),0);class _ extends v{constructor(t){super(t,g,"Sum"),this.rolls=t,this.rolls=t}toString(){return this.rolls.map((t=>t.toString())).join(" + ")}mean(){return g(this.rolls.map((t=>t.mean())))}variance(){return g(this.rolls.map((t=>t.variance())))}}class w extends _{constructor(t,e){super(Array.from({length:t},(t=>e))),this.n=t,this.R=e,this.R=e,this.n=t}toString(){return`${this.n}${this.R}`}}let y=t=>t.reduce(((t,e)=>t*e),1);class x extends v{constructor(t){super(t,y,"Prod"),this.rolls=t,this.rolls=t}mean(){return y(this.rolls.map((t=>t.mean())))}}class b extends v{constructor(t){super(t,(t=>Math.min(...t)),"Min"),this.rolls=t,this.rolls=t}}class E extends r{constructor(t){super(),this.rolls=t,this.rolls=t}roll(){let t=Number.MIN_SAFE_INTEGER;return this.rolls.forEach((e=>{t=Math.max(e.roll(),t)})),t}eq(t){return m(this,t)}density(){return new t}sample_space(){return void 0!==this._sample_space||(this._sample_space=new e(void 0,(t=>this.rolls.reduce(((e,r)=>e*r.cdf(t)),1)))),this._sample_space}toString(){return`Max(${this.rolls.map((t=>t.toString())).join(",")})`}}class $ extends r{constructor(t,e){super(),this.R=t,this.op=e,this.R=t,this.op=e}roll(){return this.op(this.R.roll())}density(){let e=new t;for(let[t,r]of this.R.sample_space()){let s=this.op(t);e.increment(s,r)}return e}}class q extends ${constructor(t){super(t,(t=>-t)),this.R=t,this.R=t}toString(){return`-${this.R}`}eq(t){return this.R.eq(t.R)}}class k{constructor(t){this.s=t,this.original_input=t,this.tokenized_input=this.original_input.toLowerCase().replace(/\s/g,""),this.tokens=new Map}addToken(t,e){let r=`x_${this.tokens.size}`;for(this.tokens.set(r,e);this.tokenized_input.includes(t);)this.tokenized_input=this.tokenized_input.replace(t,r)}parseProb(t){var e,r;let s;if(s=t.match(/(?<num>[0-9]+)\/(?<den>[1-9]+[0-9]*)/)){let t=+(null===(e=s.groups)||void 0===e?void 0:e.num),i=+(null===(r=s.groups)||void 0===r?void 0:r.den);if(console.log(`${t} / ${i}`),i>=t)return t/i}let i=+t;return i>1?1/i:i}tokenizeParentheticals(t){var e,r,s,i,h,a,u,p,d,c;let f,m=t.match(/(?<prefix>[A-Za-z0-9]*)\((?<infix>[^()]*)\)/);if(m){let t=null===(e=null==m?void 0:m.groups)||void 0===e?void 0:e.infix.split(",");if(m&&t&&t.length>1){let e=t.map((t=>this._parse(t)));switch(null===(r=m.groups)||void 0===r?void 0:r.prefix){case"sum":f=new _(e);break;case"prod":f=new x(e);break;case"max":case"max":f=new E(e);break;case"min":f=new b(e);break;case"or":f=new o(e);break;default:f=Error(`unknown symbol: ${null===(s=null==m?void 0:m.groups)||void 0===s?void 0:s.prefix}`)}}else f=this._parse((null===(i=m.groups)||void 0===i?void 0:i.infix)||"");if(m&&f){if(null===(h=m.groups)||void 0===h?void 0:h.prefix.match(/[0-9]+/)){let t=+(null===(a=m.groups)||void 0===a?void 0:a.prefix);f=new w(t,f)}if("g"==(null===(u=m.groups)||void 0===u?void 0:u.prefix)){let t=this.parseProb(null===(p=m.groups)||void 0===p?void 0:p.infix);f=new l(t)}if("c"==(null===(d=m.groups)||void 0===d?void 0:d.prefix)){let t=this.parseProb(null===(c=m.groups)||void 0===c?void 0:c.infix)||.5;f=new n(t)}this.addToken(m[0],f)}}}parseOp(t,e,r){let s=t.split(e);if(s.length>1)return r(s.map((t=>this._parse(t))))}parseBinaryOp(t,e,r){var s,i;let n=new RegExp(`^(?<left>.*)${e}(?<right>.*)$`),l=t.match(n);if(l)return r(this._parse((null===(s=l.groups)||void 0===s?void 0:s.left)||""),this._parse((null===(i=l.groups)||void 0===i?void 0:i.right)||""))}_parse(t){var e,r,l,h,m;let v,g;if(t.match(/[()]/)&&console.log(`Warning: no parentheticals in _parse: ${t}`),v=this.parseOp(t,"+",(t=>new _(t))))return v;if(v=this.parseOp(t,"*",(t=>new x(t))))return v;if(v=this.parseOp(t,"<<",(t=>new b(t))))return v;if(v=this.parseOp(t,">>",(t=>new E(t))))return v;if(v=this.parseOp(t,"|",(t=>new o(t))))return v;if(v=this.parseBinaryOp(t,"=",((t,e)=>new a(t,e))))return v;if(v=this.parseBinaryOp(t,"!=",((t,e)=>new u(t,e))))return v;if(v=this.parseBinaryOp(t,"<",((t,e)=>new c(t,e))))return v;if(v=this.parseBinaryOp(t,"<=",((t,e)=>new d(t,e))))return v;if(v=this.parseBinaryOp(t,">",((t,e)=>new p(t,e))))return v;if(v=this.parseBinaryOp(t,">=",((t,e)=>new f(t,e))))return v;if(g=t.match(/^-(?<infix>.*$)/)){let t=this._parse((null===(e=g.groups)||void 0===e?void 0:e.infix)||"");return new q(t)}if(g=t.match(/^(?<n_rolls>[0-9]*)d(?<roll_size>[0-9]+)$/),g&&(null===(r=g.groups)||void 0===r?void 0:r.roll_size)){let t=+(null===(l=g.groups)||void 0===l?void 0:l.roll_size),e=new s(t);return(null===(h=g.groups)||void 0===h?void 0:h.n_rolls)?new w(+((null===(m=g.groups)||void 0===m?void 0:m.n_rolls)||1),e):e}return(g=t.match(/^([0-9]*)$/))?new i(+t):(g=t.match(/^c$/))?new n:(g=t.match(/^x_[0-9]*$/))?this.tokens.get(t)||Error(`unknown symbol: ${t}`):new Error(`unknown symbol: ${t}`)}parse(){for(;this.tokenized_input.match(/[()]/);)this.tokenizeParentheticals(this.tokenized_input);return this._parse(this.tokenized_input)}}const M=document.querySelector("#input"),S=document.querySelector("#button"),R=document.querySelector("#list");if(null==M||null==S||null==R)throw new Error("fix ya ids");var I=new Map,B=0;function z(t){var e,r;let s=t.currentTarget.id.match("roll-(?<id>[0-9]*)");if(null==(null===(e=null==s?void 0:s.groups)||void 0===e?void 0:e.id))throw new Error("fix ya ids");let i=+s.groups.id,n=document.getElementById(`display-${i}`);if(null==n)throw new Error("fix ya ids");n.innerHTML=(null===(r=I.get(i))||void 0===r?void 0:r.roll().toString())||""}function A(t){var e,r;let s=t.currentTarget.id.match("delete-(?<id>[0-9]*)");if(null==(null===(e=null==s?void 0:s.groups)||void 0===e?void 0:e.id))throw new Error("fix ya ids");let i=+s.groups.id;I.delete(i),null===(r=document.getElementById(`li-${i}`))||void 0===r||r.remove()}function N(t){var e;let r=t.currentTarget.id.match("show-stats-(?<id>[0-9]*)");if(null==(null===(e=null==r?void 0:r.groups)||void 0===e?void 0:e.id))throw new Error("fix ya ids");let s=+r.groups.id,i=document.getElementById(`stats-${s}`);if(null==i)throw new Error("fix ya ids");"block"===i.style.display?i.style.display="none":i.style.display="block",function(t){let e=I.get(t),r=document.getElementById(`mean-${t}`),s=document.getElementById(`median-${t}`);if(null==e||null==r||null==s)throw new Error("fix ya ids");r.textContent="Mean: "+e.mean().toString(),s.textContent="Median: "+e.median().toString()}(s)}S.onclick=function(){var t;let e=null===(t=document.querySelector("#input"))||void 0===t?void 0:t.value;if(e){let t=new k(e).parse();if(t){let e=document.createElement("li");e.id=`li-${B}`,e.innerHTML=`\n                <div class="list-item-div">\n                    <div class="row">\n                        <div class="column">\n                            <div>${t}</div>\n                        </div>\n                        <div class="column">\n                            <button class="roll-button" id="roll-${B}">Roll</button>\n                            <p class="roll-display" id="display-${B}"></p>\n                        </div>\n                        <div class="column">\n                            <button class="show-stats" id="show-stats-${B}">Show Stats</button>\n                        </div>\n                        <div class="column">\n                            <button class="delete" id="delete-${B}">Delete</button>\n                        </div>\n                    </div>\n                    <div class="content" id="stats-${B}">\n                        <p id="mean-${B}"></p>\n                        <p id="median-${B}"></p>\n                    </div>\n                </div>\n            `,null==R||R.append(e);let r=document.getElementById(`roll-${B}`),s=document.getElementById(`delete-${B}`),i=document.getElementById(`show-stats-${B}`);if(null==r||null==s)throw new Error("fix ya ids");r.onclick=z,s.onclick=A,i.onclick=N,I.set(B,t),B++}}}})();